"use strict";(self.webpackChunkmycompany_docs=self.webpackChunkmycompany_docs||[]).push([["2477"],{5550:function(e,i,n){n.r(i),n.d(i,{default:()=>h,frontMatter:()=>l,metadata:()=>s,assets:()=>r,toc:()=>d,contentTitle:()=>o});var s=JSON.parse('{"id":"sales/discounts","title":"Discounts: application logic","description":"In the system, a discount is a separate \u201CDiscount\u201D object that can be applied to sales document lines (primarily, to sales order lines).","source":"@site/docs/sales/discounts.md","sourceDirName":"sales","slug":"/sales/discounts","permalink":"/en/sales/discounts","draft":false,"unlisted":false,"editUrl":"https://github.com/lsfusion-solutions/mycompany-docs/edit/main/docs/sales/discounts.md","tags":[],"version":"current","lastUpdatedAt":1767097943000,"frontMatter":{"title":"Discounts: application logic"},"sidebar":"docs","previous":{"title":"Pricelists and price types","permalink":"/en/sales/pricelists"},"next":{"title":"Sales reports","permalink":"/en/sales/reports"}}'),t=n("5893"),c=n("65");let l={title:"Discounts: application logic"},o=void 0,r={},d=[{value:"Where discounts are configured",id:"where-discounts-are-configured",level:2},{value:"How the system decides whether a discount matches a line",id:"how-the-system-decides-whether-a-discount-matches-a-line",level:2},{value:"1) By items and categories",id:"1-by-items-and-categories",level:3},{value:"2) By validity period",id:"2-by-validity-period",level:3},{value:"3) By price type",id:"3-by-price-type",level:3},{value:"4) By location",id:"4-by-location",level:3},{value:"5) By minimum quantity and line amount",id:"5-by-minimum-quantity-and-line-amount",level:3},{value:"6) By cumulative conditions per customer",id:"6-by-cumulative-conditions-per-customer",level:3},{value:"How the price is calculated for a discount",id:"how-the-price-is-calculated-for-a-discount",level:2},{value:"Option 1: percent discount",id:"option-1-percent-discount",level:3},{value:"Option 2: discount via price type",id:"option-2-discount-via-price-type",level:3},{value:"How an automatic discount is selected",id:"how-an-automatic-discount-is-selected",level:2},{value:"Manual discount selection in a line",id:"manual-discount-selection-in-a-line",level:2},{value:"Automatic discount recalculation",id:"automatic-discount-recalculation",level:2},{value:"How to disable auto recalculation",id:"how-to-disable-auto-recalculation",level:3},{value:"Where discounts are shown",id:"where-discounts-are-shown",level:2},{value:"Typical issues",id:"typical-issues",level:2},{value:"Examples",id:"examples",level:2},{value:"Example 1. Percent discount with a quantity threshold",id:"example-1-percent-discount-with-a-quantity-threshold",level:3},{value:"Example 2. Discount via a price type",id:"example-2-discount-via-a-price-type",level:3},{value:"Example 3. Two discounts match \u2014 the most beneficial one is selected",id:"example-3-two-discounts-match--the-most-beneficial-one-is-selected",level:3}];function a(e){let i={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,c.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.p,{children:["In the system, a discount is a separate ",(0,t.jsx)(i.strong,{children:"\u201CDiscount\u201D"})," object that can be applied to sales document lines (primarily, to ",(0,t.jsx)(i.a,{href:"/en/sales/orders",children:"sales order"})," lines)."]}),"\n",(0,t.jsx)(i.p,{children:"A discount can be defined:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["as a ",(0,t.jsx)(i.strong,{children:"discount percent"}),";"]}),"\n",(0,t.jsxs)(i.li,{children:["as a ",(0,t.jsx)(i.strong,{children:"price from a price type"})," (that is, \u201Cfix the price by another price type\u201D)."]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"where-discounts-are-configured",children:"Where discounts are configured"}),"\n",(0,t.jsxs)(i.p,{children:["Usually, the discount list is located in ",(0,t.jsx)(i.strong,{children:"\u201CSales\u201D \u2192 \u201COperations\u201D \u2192 \u201CDiscounts\u201D"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"In the discount card, you specify:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"validity period;"}),"\n",(0,t.jsx)(i.li,{children:"applicability conditions;"}),"\n",(0,t.jsxs)(i.li,{children:["which ",(0,t.jsx)(i.a,{href:"/en/masterdata/items",children:"items"}),"/categories it applies to;"]}),"\n",(0,t.jsxs)(i.li,{children:["which ",(0,t.jsx)(i.a,{href:"/en/sales/pricelists",children:"price types"})," are allowed;"]}),"\n",(0,t.jsxs)(i.li,{children:["if needed \u2014 which ",(0,t.jsx)(i.a,{href:"/en/inventory/locations",children:"locations"})," it applies to;"]}),"\n",(0,t.jsx)(i.li,{children:"discount amount (percent) or a price type (if the discount is defined by price)."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"how-the-system-decides-whether-a-discount-matches-a-line",children:"How the system decides whether a discount matches a line"}),"\n",(0,t.jsx)(i.p,{children:"For a sales order line, the system checks a discount against a set of conditions."}),"\n",(0,t.jsx)(i.h3,{id:"1-by-items-and-categories",children:"1) By items and categories"}),"\n",(0,t.jsx)(i.p,{children:"A discount can be linked:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"to specific items;"}),"\n",(0,t.jsx)(i.li,{children:"to item categories (category hierarchy)."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"If neither categories nor items are selected in a discount, the discount is considered misconfigured and the system will not allow saving it."}),"\n",(0,t.jsx)(i.h3,{id:"2-by-validity-period",children:"2) By validity period"}),"\n",(0,t.jsx)(i.p,{children:"A discount is applied only if the line date is within the interval:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"the line date is not earlier than the start date;"}),"\n",(0,t.jsx)(i.li,{children:"the line date is not later than the end date."}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"3-by-price-type",children:"3) By price type"}),"\n",(0,t.jsx)(i.p,{children:"A discount can be restricted by price types:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"if price types are specified in the discount, it applies only to lines with one of these price types;"}),"\n",(0,t.jsx)(i.li,{children:"if price types are not specified, the restriction does not apply."}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"4-by-location",children:"4) By location"}),"\n",(0,t.jsx)(i.p,{children:"A discount can be restricted by locations:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"if locations are specified in the discount, it applies only to lines with a matching location;"}),"\n",(0,t.jsx)(i.li,{children:"if locations are not specified, the restriction does not apply."}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"5-by-minimum-quantity-and-line-amount",children:"5) By minimum quantity and line amount"}),"\n",(0,t.jsx)(i.p,{children:"A discount can require that the line has at least:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"a minimum quantity;"}),"\n",(0,t.jsx)(i.li,{children:"a minimum amount."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"If the line does not reach the threshold, the discount is not applied."}),"\n",(0,t.jsx)(i.p,{children:"Important: the amount used for the check is the \u201Cfull amount\u201D (calculated from quantity and price; tax may be included if applicable)."}),"\n",(0,t.jsx)(i.h3,{id:"6-by-cumulative-conditions-per-customer",children:"6) By cumulative conditions per customer"}),"\n",(0,t.jsxs)(i.p,{children:["A discount can be cumulative and enabled only if the ",(0,t.jsx)(i.a,{href:"/en/masterdata/partners",children:"customer"})," has:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"total volume of previous purchases above a threshold;"}),"\n",(0,t.jsx)(i.li,{children:"or purchase volume for the previous month above a threshold."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"These values are taken from the customer\u2019s sales history."}),"\n",(0,t.jsx)(i.h2,{id:"how-the-price-is-calculated-for-a-discount",children:"How the price is calculated for a discount"}),"\n",(0,t.jsx)(i.p,{children:"For each matching discount, the system calculates the \u201Cdiscount price\u201D."}),"\n",(0,t.jsx)(i.h3,{id:"option-1-percent-discount",children:"Option 1: percent discount"}),"\n",(0,t.jsx)(i.p,{children:"If the discount specifies a percent, the discount price is calculated as:"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.code,{children:"discount price = base price \xd7 (100 \u2212 discount percent) / 100"})}),"\n",(0,t.jsx)(i.h3,{id:"option-2-discount-via-price-type",children:"Option 2: discount via price type"}),"\n",(0,t.jsx)(i.p,{children:"If the discount specifies a price type, the discount price is taken from this price type for the line date."}),"\n",(0,t.jsx)(i.p,{children:"Practical meaning:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"you can define a discount as \u201Csell at wholesale price\u201D or \u201Csell at the price from a special price list\u201D."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"how-an-automatic-discount-is-selected",children:"How an automatic discount is selected"}),"\n",(0,t.jsxs)(i.p,{children:["If multiple discounts match a line, the system automatically selects the ",(0,t.jsx)(i.strong,{children:"most beneficial for the customer"})," among automatic discounts."]}),"\n",(0,t.jsx)(i.p,{children:"Selection rule:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["among all matching automatic discounts, the one with the ",(0,t.jsx)(i.strong,{children:"minimum discount price"})," is selected."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"This corresponds to the selection logic in code: the discount with the minimal calculated price is chosen."}),"\n",(0,t.jsx)(i.p,{children:"Important:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"discounts are not summed;"}),"\n",(0,t.jsx)(i.li,{children:"one discount is chosen that gives the minimum price (that is, the \u201Cbest benefit\u201D within the configured discounts)."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"manual-discount-selection-in-a-line",children:"Manual discount selection in a line"}),"\n",(0,t.jsx)(i.p,{children:"In a sales order line, a user can manually select a discount (the \u201CDiscount\u201D field)."}),"\n",(0,t.jsx)(i.p,{children:"How it works:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsx)(i.li,{children:"The user opens the discount selection."}),"\n",(0,t.jsx)(i.li,{children:"The system shows only discounts that match the line by conditions."}),"\n",(0,t.jsx)(i.li,{children:"The user selects a discount."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"If the selected discount is percent-based, the system fills in the percent in the line (if the user has not entered a percent manually)."}),"\n",(0,t.jsx)(i.p,{children:"If the selected discount is defined by a price type, the system fills in the price by that price type and recalculates the discount/line amount."}),"\n",(0,t.jsx)(i.h2,{id:"automatic-discount-recalculation",children:"Automatic discount recalculation"}),"\n",(0,t.jsx)(i.p,{children:"If automatic discount recalculation is enabled, the system recalculates the discount for a line when these values change:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"document/line date;"}),"\n",(0,t.jsx)(i.li,{children:"customer;"}),"\n",(0,t.jsx)(i.li,{children:"item;"}),"\n",(0,t.jsx)(i.li,{children:"quantity;"}),"\n",(0,t.jsx)(i.li,{children:"price;"}),"\n",(0,t.jsx)(i.li,{children:"document type;"}),"\n",(0,t.jsx)(i.li,{children:"location;"}),"\n",(0,t.jsx)(i.li,{children:"total document amount."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Automatic recalculation is performed only for discounts that are not marked as \u201Cmanual\u201D."}),"\n",(0,t.jsxs)(i.p,{children:["The order also has the ",(0,t.jsx)(i.strong,{children:"\u201CCalculate discounts\u201D"})," action, which forces recalculation of discounts for all lines (except manual ones)."]}),"\n",(0,t.jsx)(i.h3,{id:"how-to-disable-auto-recalculation",children:"How to disable auto recalculation"}),"\n",(0,t.jsxs)(i.p,{children:["In settings, there is a parameter ",(0,t.jsx)(i.strong,{children:"\u201CDo not automatically calculate discounts in order\u201D"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"If it is enabled:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"automatic recalculation on changes is not performed;"}),"\n",(0,t.jsx)(i.li,{children:"the user applies discounts manually and/or via the \u201CCalculate discounts\u201D button."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"where-discounts-are-shown",children:"Where discounts are shown"}),"\n",(0,t.jsx)(i.p,{children:"Discounts are usually visible:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"in order lines (selected discount, percent/price);"}),"\n",(0,t.jsx)(i.li,{children:"in order totals (discount amount for the document);"}),"\n",(0,t.jsx)(i.li,{children:"in invoices (if discounts are transferred to the invoice);"}),"\n",(0,t.jsx)(i.li,{children:"in sales reports."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"typical-issues",children:"Typical issues"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Discount is not applied"})," \u2014 check date, price type, location, quantity/amount thresholds, and item/category restrictions."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Multiple discounts match but a \u201Cwrong\u201D one is selected"})," \u2014 the system selects the discount with the minimum discount price. If you need another one, use manual selection."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Discount \u201Cdisappears\u201D after changing a line"})," \u2014 auto recalculation is enabled and the selected discount is not manual."]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(i.p,{children:"Below are a few simplified examples to illustrate how the rules work."}),"\n",(0,t.jsx)(i.h3,{id:"example-1-percent-discount-with-a-quantity-threshold",children:"Example 1. Percent discount with a quantity threshold"}),"\n",(0,t.jsx)(i.p,{children:"Discount conditions:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"items: \u201CCable\u201D (or category \u201CCables\u201D);"}),"\n",(0,t.jsx)(i.li,{children:"validity: current month;"}),"\n",(0,t.jsxs)(i.li,{children:["minimum quantity in line: ",(0,t.jsx)(i.code,{children:"10"}),";"]}),"\n",(0,t.jsxs)(i.li,{children:["discount: ",(0,t.jsx)(i.code,{children:"5%"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Order situation:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["line: \u201CCable\u201D, quantity ",(0,t.jsx)(i.code,{children:"8"}),", price ",(0,t.jsx)(i.code,{children:"100"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Result:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["the discount is ",(0,t.jsx)(i.strong,{children:"not applied"}),", because the quantity is less than ",(0,t.jsx)(i.code,{children:"10"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["If you change the quantity to ",(0,t.jsx)(i.code,{children:"10"}),":"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["discount price = ",(0,t.jsx)(i.code,{children:"100 \xd7 (100 \u2212 5) / 100 = 95"}),";"]}),"\n",(0,t.jsxs)(i.li,{children:["the line will use price ",(0,t.jsx)(i.code,{children:"95"})," (or percent ",(0,t.jsx)(i.code,{children:"5%"}),", depending on how your form is configured to display it)."]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"example-2-discount-via-a-price-type",children:"Example 2. Discount via a price type"}),"\n",(0,t.jsx)(i.p,{children:"Discount conditions:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"items: category \u201CHome appliances\u201D;"}),"\n",(0,t.jsx)(i.li,{children:"discount is defined via price type: \u201CWholesale\u201D;"}),"\n",(0,t.jsx)(i.li,{children:"validity: unlimited."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Order situation:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["line: \u201CKettle\u201D, quantity ",(0,t.jsx)(i.code,{children:"1"}),";"]}),"\n",(0,t.jsxs)(i.li,{children:["current order price (for example, by a base price type) \u2014 ",(0,t.jsx)(i.code,{children:"3,000"}),";"]}),"\n",(0,t.jsxs)(i.li,{children:["price by the \u201CWholesale\u201D price type on the order date \u2014 ",(0,t.jsx)(i.code,{children:"2,700"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Result:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["when applying this discount, the system will fill in price ",(0,t.jsx)(i.code,{children:"2,700"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Practical meaning: instead of calculating a \u201Cpercent\u201D, you fix that prices from another price type should be used for this group of goods."}),"\n",(0,t.jsx)(i.h3,{id:"example-3-two-discounts-match--the-most-beneficial-one-is-selected",children:"Example 3. Two discounts match \u2014 the most beneficial one is selected"}),"\n",(0,t.jsx)(i.p,{children:"Let two automatic discounts match a line:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["Discount A: ",(0,t.jsx)(i.code,{children:"10%"})]}),"\n",(0,t.jsxs)(i.li,{children:["Discount B: ",(0,t.jsx)(i.code,{children:"5%"})]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["Base price in the line: ",(0,t.jsx)(i.code,{children:"100"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"Discount price:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["for discount A: ",(0,t.jsx)(i.code,{children:"100 \xd7 (100 \u2212 10) / 100 = 90"}),";"]}),"\n",(0,t.jsxs)(i.li,{children:["for discount B: ",(0,t.jsx)(i.code,{children:"100 \xd7 (100 \u2212 5) / 100 = 95"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Auto selection:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["the system will select discount A, because the discount price ",(0,t.jsx)(i.code,{children:"90"})," is ",(0,t.jsx)(i.strong,{children:"lower"})," than ",(0,t.jsx)(i.code,{children:"95"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"If business rules require applying another discount (not the most beneficial one), use manual discount selection in the line."})]})}function h(e={}){let{wrapper:i}={...(0,c.a)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},65:function(e,i,n){n.d(i,{Z:function(){return o},a:function(){return l}});var s=n(7294);let t={},c=s.createContext(t);function l(e){let i=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(c.Provider,{value:i},e.children)}}}]);